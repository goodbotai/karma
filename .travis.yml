sudo: required
group: deprecated-2017Q4

language: node_js
node_js:
  - 9.3.0

services:
  - docker

before_install:
  - pyenv global 2.7.13

install:
  - npm install --dev
  - npm install travis-ecs-deploy -g

script:
  - yarn lint
  - echo $ECS_CLUSTER_$(echo $TRAVIS_TAG | awk '{print toupper($0)}')
  - echo ECS_CLUSTER_$(echo $TRAVIS_TAG | awk '{print toupper($0)}') 

env:
  global:
    - IMAGE_NAME=goodbotai/karma
    - DEPLOY_BRANCHES=$TRAVIS_TAG
    # AWS_REGION
    - secure: "Iwptp3StpffT6vsqpAeMwbFRiaFN8ct3qlxnGRQIPc14NzR45nAp63vT036lygkhpCvv9w+r95oikBY2KY9MmsZfmqkVBj0rdihvB3fVZgPrWr7zk/f1oqGgCeMLrRJjAlz+Q2KtcBBDsKK7M6U5YfLvwtyr9clPRA6qeyefooFpch/LZAG5d4i53B+ARw9XPbk39eJfi/L2CGY0MFFfk3928Dyn3vDKBhHB24G63yPHlu1kc9BRPj0Li9ZD2J+yOGVKOnmFGWlS7CshOr4kRMTFBYfI/d8h8UPEFH2p78E77xWVakXlR8soOnoCHqNzZbxAVB7WAj2EUx/UYRMqodURloGnnMd3VgrerGNIeKFSiY9hA6b1sc8uufy2JVv4ogX4kkhDNZvx/lcNW77/nLpmGJt+D2fJlRIE66V+ECgqD3+WqPuBOfy6HO5kwoAEjMhTBUy2lpKVpi4CtkC76ZC+a9IjcHBBvRsocLJED30eyv0MaXVWTJmQqWpz4xlChoEcxROs4egmqGMG9QHvQJhZMpNAARqrm+KWXyCDbeu67uacLmHIRKcAVljWqkaaYt+ikJyGfd5g3//55/0WSbs/mregiRD4Zkagq9jeKBnRy99LZJUmLeke1OB+VtjNPJL8aW0YSSGtDh4yjMhYzKMENkrjuPBreH2XiN442LY="
    # AWS_ACCESS_KEY_ID
    - secure: "MY7XVYOQ8LT1cyJYnBr1nHT7HlrJ2IM23kHbrvDGUeN+dMSoqEeJHvkkGA5NnK3b9LFy9YF47mUSaHtMykYsateCOy27wqcV/VLl6yE6qSfprKt7d4ZLr4Zcx3hGMrHkOSb5HlbSrDg8RIaJY5EvJwdRSk9XkHK19m+GN/eTC9GQc5cRxSjtvr3NnubQJlxavfkl/OvdZwriGqNFf9U9yJVBgP8GEmfdLjB8wdQH6fgvO1xnjUFxZoMlfM6vF7UQ0vZ8x7xcWfbQ/DgS1MTYYqDGQmWqF+YSi0nMAyULfqy97SSQ4MAT2lQukd37yysTZX6nbLLoHmStaO2tvxhO5/ArCWiAaDpFp9LUALllsOUytklynPCbTe8EPKDD1tBsBoZZ4YLqFU3yLw9i2dhS15+EieiVtkKAPBC1hK5wZvCcGDEkYgiZJkS1UVpj7ZnTtKqzbjDD9YILbO7CicC04xET5QmdO5yt0mZyNt+iaK5QjJwEEJ5qUbjPTYdm5Vy/CAaOsOLryo1PzBlw39WIb7T7cW0q2CLgn9rlqRVHl5xKrW1YQAFiVU6tRl+yx1GxoD6shOtNKDdA10A/4c1UaleQwuLqly6JVS94tCQaVLbyKYEDCe8FGfehkLD3bYZ7yhb+Ud2mJ+XBRA6AO+J2ZxkkXyTHpb/vU29vlAC+jWw="
    # AWS_SECRET_ACCESS_KEY
    - secure: "XP/y6XiZE55K/Xnv3eZUqGKptAsUXPzvG+8lKBQsxp0o48JoO51rVexG8x2kzOGlz8IXVj7Amw6DtITIyvGgyAVgAsj6WuYBwSZ27k1JYiaZ8B4i5I906YIAz+msqqUzEu79MLz5Kn/ifzccfEddxPnhB7625+d+F8/bEQLH+qriUspjtflucN8grHUDIt+pH/xCd30n34zeC5FBNrSlm11I2a7xI6r2UuOATbX8o+7Q4FBwjMSWSeihbJZfiWfLV0/ffvaiw2SLpsfLtZh+EKdxtMRU48elPvgmI78mwP4KMy4UTDG21NSL4rPhUzZOHGUKxlVzAyPYOCuMNx+pez4LUWF5TuRs6a3Z3KwUvNG0aCHFyZITB5QsoflIR/ADdhoLQ3R8YGEADsG/SEz38cvXzg6gulaHiNEF82pAnBNoCmbQNZFY6Nc+6aUIdE4vAd/8WH0EX9RzwYZQr39XPz1aM5LNzNEzMI+lR01euwL7oiqXkLcOsHgRRedynw//P6omLSdGAKCMC+2Rgf2UxUJ4qmiW6iGxrhiiJ80LlIgEOvJJsCaN/uJKSXN2c7SoSYZQ4gVa9a6Zs0qX5cvCEGnv9BgG1nAvtKgEvmPiMb/koXmoTQ3EX6/P8OEz/1S1SBckIpMpyNyrvZzH6DvpJfHBbxaKVaCjLUOa4hVH4vc="
    # REMOTE_IMAGE_URL
    - secure: "gE90SEvdDjOeN5HKD9SfwkCGvUTaqJRpXgBbHpnLW91XM0KYnzA3gmBWYAhAoyfQNbfvlpe50k/38aDigXWFFyiGFnGxuPcs7fCRDgyERubyxotIO1bV9IVEtsKM49UYUnn/7wxrJz38iGVqdw5xki88nXoIfxVFenFroPBhXtrtPk3xHS5e2yRQPXb6ayE2mee3D5TQ2hl9H2XYGdM8v+xALExIWadk4YNE4pmuQp/JSkZ0YY6opuIjAXry2AIj5BsVByBsYeUvefP3ziLarfrQS/E0v0Qn6pBP6ZqbOsHVoxlOJSzJgb9Ka2Apd26XK24waKeRpyVie+I2C7MSHxn3DZdX50RarayQrHeUwZpSMr0Yh4C1RGoPCrhOqLFe7jpXi6Z7wdp8KL5sDhj2X4kAL8nc0YI0jnHHZThmx7X03Emq4q+7yUHrFWAtoZ/xq/KMoClOhMXkqakODnymAqiCbha8sQ1HWYNsPXbOBV9cPMAuXWBb5U3FR6Beys19B0h31gHhcGRV57UhfXR9bKqL8/cxWZZ3ttp8to3vFYYPAxx/hFG92KU+7YK7HpFqPzcWjBcW9YAe/0trtCJZU5e51nTMzUcRZSr6+KydlyI5OQIkiEXi10ivqXwc5upZ1sgZjfZ4TibrYO4nuYxq+6U3Dud3jL6fXot7Ag/E9kg="
    - ECS_CLUSTER_$(echo $TRAVIS_TAG | awk '{print toupper($0)}')=Karma
    - ECS_SERVICE_$(echo $TRAVIS_TAG | awk '{print toupper($0)}')=karma

deploy:
  skip_cleanup: true
  provider: script
  script:
    - yarn run travis-ecs-deploy
  on:
    tags: true
    branch: master
    
